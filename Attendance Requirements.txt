/////////////////////////////////////Attendance Requirements/////////////////////////////////////

TO COVER >= 80% STUDENTS------------------------------------------------------>

DELIMITER //
CREATE PROCEDURE GetHighAttendanceStudents()
BEGIN
    SELECT A.reg_no, A.course_code,A.type, 
    (SUM(CASE WHEN A.status = 'Present' THEN A.lecture_time_per_session ELSE 0 END) / c.lecture_hours)*100 AS attendance_percentage
    FROM Attendance A
    JOIN course_unit c ON A.course_code = c.course_code
    GROUP BY A.reg_no, A.course_code, A.type
    HAVING attendance_percentage >= 80.00;
END;
//
DELIMITER ;

CALL GetHighAttendanceStudents();

TO COVER < 80% STUDENTS--------------------------------------------------------------->

DELIMITER //
CREATE PROCEDURE GetLowAttendanceStudents()
BEGIN
    SELECT A.reg_no, A.course_code,A.type, 
    (SUM(CASE WHEN A.status = 'Present' THEN A.lecture_time_per_session ELSE 0 END) / c.lecture_hours)*100 AS attendance_percentage
    FROM Attendance A
    JOIN course_unit c ON A.course_code = c.course_code
    GROUP BY A.reg_no, A.course_code, A.type
    HAVING attendance_percentage < 80.00;
END;
//
DELIMITER ;

CALL GetLowAttendanceStudents();

WITH MEDICALS >= 80% STUDENTS--------------------------------------------------------->

DELIMITER //
CREATE PROCEDURE GetHighMedicalAttendanceStudents()
BEGIN
    SELECT A.reg_no, A.course_code,A.type,
    (SUM(CASE WHEN A.status = 'Present' OR A.status = 'Medical Leave' THEN A.lecture_time_per_session ELSE 0 END) / c.lecture_hours)*100 AS attendance_percentage
    FROM attendance A
    JOIN course_unit c ON A.course_code = c.course_code
    GROUP BY A.reg_no, A.course_code,A.type
    HAVING attendance_percentage >= 80.00;
END;
//
DELIMITER ;

CALL GetHighMedicalAttendanceStudents();

WITH MEDICAL < 80% STUDENTS------------------------------------------------------------->

DELIMITER //
CREATE PROCEDURE GetLowMedicalAttendanceStudents()
BEGIN
    SELECT A.reg_no, A.course_code,A.type, 
    (SUM(CASE WHEN A.status = 'Present' OR A.status = 'Medical Leave' THEN A.lecture_time_per_session ELSE 0 END) / c.lecture_hours)*100 AS attendance_percentage
    FROM attendance A
    JOIN course_unit c ON A.course_code = c.course_code
    GROUP BY A.reg_no, A.course_code,A.type
    HAVING attendance_percentage < 80.00;
END;
//
DELIMITER ;

CALL GetLowMedicalAttendanceStudents();

AS A SUMMARY FOR WHOLE BATCH--------------------------------------------------------------->
1. by giving the course code

DELIMITER //
CREATE PROCEDURE GetBatchAttendanceSummary_courseWise(IN courseCode CHAR(7))
BEGIN
    SELECT A.reg_no,A.type,
        (SUM(CASE WHEN A.status = 'Present' THEN A.lecture_time_per_session ELSE 0 END) / c.lecture_hours)*100 AS attendance_percentage,
        CASE WHEN (SUM(CASE WHEN A.status = 'Present' THEN A.lecture_time_per_session ELSE 0 END) / c.lecture_hours)*100 >= 80.00 THEN 'Eligible' ELSE 'Not Eligible' END AS eligibility
    FROM attendance A
    JOIN course_unit c ON A.course_code = c.course_code
    WHERE A.course_code = courseCode
    GROUP BY A.reg_no,A.type;
END;
//
DELIMITER ;

CALL GetBatchAttendanceSummary_courseWise();

2. For whole batch and all the subjects

DELIMITER //
CREATE PROCEDURE GetBatchAttendanceForallsubjectswitheligibility()
BEGIN
    SELECT A.reg_no,c.course_code,A.type,
    (SUM(CASE WHEN A.status = "Present" OR A.status = "Medical Leave" THEN A.lecture_time_per_session ELSE 0 END)/c.lecture_hours)*100 AS Attendance_percentage,
    CASE WHEN(SUM(CASE WHEN A.status = "Present" OR A.status = "Medical Leave" THEN A.lecture_time_per_session ELSE 0 END)/(c.lecture_hours))*100 >= 80.00 THEN 'Eligibity' ELSE 'NOT Eligibity' END AS Eligibity 
    FROM attendance A
    JOIN course_unit c ON A.course_code = c.course_code
    WHERE c.course_code = A.course_code
    GROUP BY A.reg_no,c.course_code,A.type;
END;
//
DELIMITER ;

3. as individuals by giving the registration number

DELIMITER //
CREATE PROCEDURE GetSummaryofAttendanceGivingRegistrationNumber(IN regno CHAR(6))
BEGIN
     SELECT A.reg_no,c.course_code,A.type,
    (SUM(CASE WHEN A.status = "Present" THEN A.lecture_time_per_session ELSE 0 END)/c.lecture_hours) AS Attendance_percentage,
    CASE WHEN(SUM(CASE WHEN A.status = "Present" THEN A.lecture_time_per_session ELSE 0 END)/(c.lecture_hours))*100 >= 80.00 THEN 'Eligibity' ELSE 'NOT Eligibity' END AS Eligibity 
    FROM attendance A
    JOIN course_unit c ON A.course_code = c.course_code
    WHERE c.course_code = A.course_code
    AND A.reg_no = regno
    GROUP BY A.reg_no,c.course_code,A.type;
END;
//
DELIMITER ;

4.as individuals by giving the registration no and course code-----------------------------------------------------

DELIMITER //
CREATE PROCEDURE GetAttendanceGivingRegistrationNumberandCourseCode(IN regno CHAR(6), ccode CHAR(7))
BEGIN
     SELECT A.reg_no,c.course_code,A.type,
    (SUM(CASE WHEN A.status = "Present" THEN A.lecture_time_per_session ELSE 0 END)/c.lecture_hours)*100 AS Attendance_percentage,
    CASE WHEN(SUM(CASE WHEN A.status = "Present" THEN A.lecture_time_per_session ELSE 0 END)/(c.lecture_hours))*100 >= 80.00 THEN 'Eligibity' ELSE 'NOT Eligibity' END AS Eligibity 
    FROM attendance A
    JOIN course_unit c ON A.course_code = c.course_code
    WHERE c.course_code = A.course_code
    AND A.reg_no = regno
    AND C.course_code = ccode 
    GROUP BY A.reg_no,c.course_code,A.type;
END;
//
DELIMITER;

For the whole batch for all the subjects with percentage and eligibilty-----------------------------------------------

DELIMITER //
CREATE PROCEDURE GetAttendanceForWholeBatch()
BEGIN
     SELECT A.reg_no,c.course_code,A.type,
    (SUM(CASE WHEN A.status = "Present" THEN A.lecture_time_per_session ELSE 0 END)/c.lecture_hours)*100 AS Attendance_percentage,
    CASE WHEN(SUM(CASE WHEN A.status = "Present" THEN A.lecture_time_per_session ELSE 0 END)/(c.lecture_hours))*100 >= 80.00 THEN 'Eligibity' ELSE 'NOT Eligibity' END AS Eligibity 
    FROM attendance A
    JOIN course_unit c ON A.course_code = c.course_code
    WHERE c.course_code = A.course_code
    GROUP BY A.reg_no,c.course_code,A.type;
END;
//
DELIMITER ;

--To Get Attendance Percentage and Eligibility When a subject has theory and practical as separate to each other

DELIMITER //
CREATE PROCEDURE Get_Att_Elig_For_Sub_Theo_OR_Prac_Each(IN regno CHAR(6), ccode CHAR(7), t VARCHAR(25))
BEGIN
    SELECT A.reg_no, c.course_code, A.type,
    ((SUM(CASE 
        WHEN A.status = "Present" THEN A.lecture_time_per_session ELSE 0 END) / c.lecture_hours)*100) AS Attendance_percentage,
    CASE
        WHEN ((SUM(CASE WHEN A.status = "Present" THEN A.lecture_time_per_session ELSE 0 END) / c.lecture_hours)*100 >= 80.00) THEN 'Eligibility' 
        ELSE 'NOT Eligibility' END AS Eligibility 
    FROM attendance A
    JOIN course_unit c ON A.course_code = c.course_code
    WHERE c.course_code = A.course_code
    AND A.reg_no = regno
    AND c.course_code = ccode
    AND ((t = 'Theory' AND A.type = 'Theory')
         OR (t = 'Practical' AND A.type = 'Practical'))
    GROUP BY A.reg_no, c.course_code, A.type;
END;
//
DELIMITER ;

--To Get Attendance Percentage and Eligibility When a subject has theory and practical as combined to each other


DELIMITER //
 CREATE PROCEDURE Get_Att_Elig_For_Sub_Theo_And_Prac_Each(IN regno CHAR(6), ccode CHAR(7))
    BEGIN
         SELECT A.reg_no, c.course_code,
         ((SUM(CASE
             WHEN A.status = "Present" THEN A.lecture_time_per_session ELSE 0 END) /(c.lecture_hours*2))*100) AS Attendance_percentage,
         CASE
             WHEN ((SUM(CASE WHEN A.status = "Present" THEN A.lecture_time_per_session ELSE 0 END) / (c.lecture_hours*2))*100 >= 80.00) THEN 'Eligibility'
             ELSE 'NOT Eligibility' END AS Eligibility
         FROM attendance A
         JOIN course_unit c ON A.course_code = c.course_code
         WHERE c.course_code = A.course_code
         AND A.reg_no = regno
         AND c.course_code = ccode
        GROUP BY A.reg_no,c.course_code;
END;
//
DELIMITER ; 

--To get the attendance percentage When a subject has thoery and practical as separate to each other

DELIMITER //
CREATE PROCEDURE Get_Att_For_Sub_Theo_OR_Prac_Each(IN regno CHAR(6), ccode CHAR(7), t VARCHAR(25))
BEGIN
    SELECT A.reg_no, c.course_code, A.type,
    ((SUM(CASE 
        WHEN A.status = "Present" THEN A.lecture_time_per_session ELSE 0 END) / c.lecture_hours)*100) AS Attendance_percentage
    FROM attendance A
    JOIN course_unit c ON A.course_code = c.course_code
    WHERE c.course_code = A.course_code
    AND A.reg_no = regno
    AND c.course_code = ccode
    AND ((t = 'Theory' AND A.type = 'Theory')
         OR (t = 'Practical' AND A.type = 'Practical'))
    GROUP BY A.reg_no, c.course_code, A.type;
END;
//
DELIMITER ;

--To get the attendance percentage When a subject has thoery and practical as combined to each other

DELIMITER //
 CREATE PROCEDURE Get_Att_For_Sub_Theo_And_Prac_Each(IN regno CHAR(6), ccode CHAR(7))
    BEGIN
         SELECT A.reg_no, c.course_code,
         ((SUM(CASE
             WHEN A.status = "Present" THEN A.lecture_time_per_session ELSE 0 END) /(c.lecture_hours*2))*100) AS Attendance_percentage,
         CASE
             WHEN ((SUM(CASE WHEN A.status = "Present" THEN A.lecture_time_per_session ELSE 0 END) / (c.lecture_hours*2))*100 >= 80.00) THEN 'Eligibility'
             ELSE 'NOT Eligibility' END AS Eligibility
         FROM attendance A
         JOIN course_unit c ON A.course_code = c.course_code
         WHERE c.course_code = A.course_code
         AND A.reg_no = regno
         AND c.course_code = ccode
        GROUP BY A.reg_no,c.course_code;
END;
//
DELIMITER ;

--To get the attendance percentage and eligibity When a subject has thoery and practical as separate to each other(with medicals)

DELIMITER //
CREATE PROCEDURE Get_Att_Elig_For_Sub_Theo_OR_Prac_Each_Medic(IN regno CHAR(6), ccode CHAR(7), t VARCHAR(25))
BEGIN
    SELECT A.reg_no, c.course_code, A.type,
    ((SUM(CASE 
        WHEN A.status = "Present" OR A.status = 'Medical Leave' THEN A.lecture_time_per_session ELSE 0 END) / c.lecture_hours)*100) AS Attendance_percentage,
    CASE
        WHEN ((SUM(CASE WHEN A.status = "Present" OR A.status = 'Medical Leave' THEN A.lecture_time_per_session ELSE 0 END) / c.lecture_hours)*100 >= 80.00) THEN 'Eligibility' 
        ELSE 'NOT Eligibility' END AS Eligibility 
    FROM attendance A
    JOIN course_unit c ON A.course_code = c.course_code
    WHERE c.course_code = A.course_code
    AND A.reg_no = regno
    AND c.course_code = ccode
    AND ((t = 'Theory' AND A.type = 'Theory')
         OR (t = 'Practical' AND A.type = 'Practical'))
    GROUP BY A.reg_no, c.course_code, A.type;
END;
//
DELIMITER ;

--To get the attendance percentage and eligibity When a subject has thoery and practical as combined to each other(with medicals)

DELIMITER //
 CREATE PROCEDURE Get_Att_Elig_For_Sub_Theo_And_Prac_Each_Medic(IN regno CHAR(6), ccode CHAR(7))
    BEGIN
         SELECT A.reg_no, c.course_code,
         ((SUM(CASE
             WHEN A.status = "Present" OR A.status = 'Medical Leave' THEN  A.lecture_time_per_session ELSE 0 END) /(c.lecture_hours*2))*100) AS Attendance_percentage,
         CASE
             WHEN ((SUM(CASE WHEN A.status = "Present" OR A.status = 'Medical Leave' THEN A.lecture_time_per_session ELSE 0 END) / (c.lecture_hours*2))*100 >= 80.00) THEN 'Eligibility'
             ELSE 'NOT Eligibility' END AS Eligibility
         FROM attendance A
         JOIN course_unit c ON A.course_code = c.course_code
         WHERE c.course_code = A.course_code
         AND A.reg_no = regno
         AND c.course_code = ccode
        GROUP BY A.reg_no,c.course_code;
END;
//
DELIMITER ; 

--To get the attendance percentage When a subject has thoery and practical as separate to each other(with medicals)


DELIMITER //
CREATE PROCEDURE Get_Att_For_Sub_Theo_OR_Prac_Each_Medic(IN regno CHAR(6), ccode CHAR(7), t VARCHAR(25))
BEGIN
    SELECT A.reg_no, c.course_code, A.type,
    ((SUM(CASE 
        WHEN A.status = "Present" OR A.status = 'Medical Leave' THEN A.lecture_time_per_session ELSE 0 END) / c.lecture_hours)*100) AS Attendance_percentage
    FROM attendance A
    JOIN course_unit c ON A.course_code = c.course_code
    WHERE c.course_code = A.course_code
    AND A.reg_no = regno
    AND c.course_code = ccode
    AND ((t = 'Theory' AND A.type = 'Theory')
         OR (t = 'Practical' AND A.type = 'Practical'))
    GROUP BY A.reg_no, c.course_code, A.type;
END;
//
DELIMITER ;

--To get the attendance percentage When a subject has thoery and practical as combined to each other(with medicals)

DELIMITER //
CREATE PROCEDURE Get_Att_For_Sub_Theo_And_Prac_Each_Medic(IN regno CHAR(6), ccode CHAR(7), t VARCHAR(25))
BEGIN
    SELECT A.reg_no, c.course_code,
    ((SUM(CASE 
        WHEN A.status = "Present" A.status = 'Medical Leave' THEN A.lecture_time_per_session ELSE 0 END) / c.lecture_hours)*100) AS Attendance_percentage
    FROM attendance A
    JOIN course_unit c ON A.course_code = c.course_code
    WHERE c.course_code = A.course_code
    AND A.reg_no = regno
    AND c.course_code = ccode
    AND ((t = 'Theory' AND A.type = 'Theory')
         OR (t = 'Practical' AND A.type = 'Practical'))
    GROUP BY A.reg_no, c.course_code;
END;
//
DELIMITER ;

--To get attendance percentage and eligibility for when a subject has theory and practical for each subject as separate 

DELIMITER // 
CREATE PROCEDURE Get_att_Elig_For_Theo_Or_Prac_Sub(ccode CHAR(7),t VARCHAR(25))
BEGIN
     SELECT A.reg_no,c.course_code,A.type,
    ((SUM(CASE 
        WHEN A.status = "Present" THEN A.lecture_time_per_session ELSE 0 END)/c.lecture_hours)*100) AS Attendance_percentage,
    CASE
        WHEN (SUM(CASE WHEN A.status = "Present" THEN A.lecture_time_per_session ELSE 0 END) / c.lecture_hours)*100 >= 80 THEN 'Eligibility'
        ELSE 'NOT Eligibility' END AS Eligibility 
    FROM attendance A
    JOIN course_unit c ON A.course_code = c.course_code
    WHERE c.course_code = A.course_code
    AND C.course_code = ccode 
    AND ((t = 'Theory' AND A.type = 'Theory')
         OR (t = 'Practical' AND A.type = 'Practical'))
    GROUP BY A.reg_no,c.course_code,A.type;
END;
//
DELIMITER ;

--To get attendance percentage and eligibility for when a subject has theory and practical for each subject as combined

DELIMITER // 
CREATE PROCEDURE Get_att_Elig_For_Theo_And_Prac_Sub(ccode CHAR(7))
BEGIN
     SELECT A.reg_no,c.course_code,
    ((SUM(CASE 
        WHEN A.status = "Present" THEN A.lecture_time_per_session ELSE 0 END)/(c.lecture_hours*2))*100) AS Attendance_percentage,
    CASE
        WHEN (SUM(CASE WHEN A.status = "Present"  THEN A.lecture_time_per_session ELSE 0 END) / (c.lecture_hours*2))*100 >= 80 THEN 'Eligibility'
        ELSE 'NOT Eligibility' END AS Eligibility 
    FROM attendance A
    JOIN course_unit c ON A.course_code = c.course_code
    WHERE c.course_code = A.course_code
    AND C.course_code = ccode 
    GROUP BY A.reg_no,c.course_code;
END;
//
DELIMITER ;

--`To get attendance percentage and eligibity for when a subject has theory and practical for each subject as separate(with medicals)

DELIMITER // 
CREATE PROCEDURE Get_att_Elig_For_Theo_Or_Prac_Sub_Medic(ccode CHAR(7),t VARCHAR(25))
BEGIN
     SELECT A.reg_no,c.course_code,A.type,
    ((SUM(CASE 
        WHEN A.status = "Present" OR A.status = 'Medical Leave' THEN A.lecture_time_per_session ELSE 0 END)/c.lecture_hours)*100) AS Attendance_percentage,
    CASE
        WHEN (SUM(CASE WHEN A.status = "Present" OR A.status = 'Medical Leave' THEN A.lecture_time_per_session ELSE 0 END) / (c.lecture_hours))*100 >= 80.00 THEN 'Eligibility'
        ELSE 'NOT Eligibility' END AS Eligibility 
    FROM attendance A
    JOIN course_unit c ON A.course_code = c.course_code
    WHERE c.course_code = A.course_code
    AND C.course_code = ccode 
    AND ((t = 'Theory' AND A.type = 'Theory')
         OR (t = 'Practical' AND A.type = 'Practical'))
    GROUP BY A.reg_no,c.course_code,A.type;
END;
//
DELIMITER ;

--To get attendance percentage and eligibility for when a subject has theory and practical for each subject as combined(with medicals)

DELIMITER // 
CREATE PROCEDURE Get_att_Elig_For_Theo_And_Prac_Sub_Medic(ccode CHAR(7))
BEGIN
     SELECT A.reg_no,c.course_code,
    ((SUM(CASE 
        WHEN A.status = "Present" A.status = 'Medical Leave' THEN A.lecture_time_per_session ELSE 0 END)/(c.lecture_hours*2))*100) AS Attendance_percentage,
    CASE
        WHEN (SUM(CASE WHEN A.status = "Present" A.status = 'Medical Leave' THEN A.lecture_time_per_session ELSE 0 END) / (c.lecture_hours*2))*100 >= 80 THEN 'Eligibility'
        ELSE 'NOT Eligibility' END AS Eligibility 
    FROM attendance A
    JOIN course_unit c ON A.course_code = c.course_code
    WHERE c.course_code = A.course_code
    AND C.course_code = ccode 
    GROUP BY A.reg_no,c.course_code;
END;
//
DELIMITER ;









